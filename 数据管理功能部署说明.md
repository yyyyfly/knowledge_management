# 数据管理功能部署说明

## 功能概述

为admin用户提供的数据库可视化管理工具，支持：
- **表结构管理**：查看、创建、删除、修改表结构
- **数据管理**：对表数据进行增删改查操作

## MySQL版本兼容性

✅ **完全兼容 MySQL 5.7 和 MySQL 8.0**

### 兼容性保证措施

1. **information_schema查询优化**
   - 使用标准的大写列名（TABLE_NAME, COLUMN_NAME等）
   - 添加TABLE_TYPE = 'BASE TABLE'过滤，只显示实际表
   - 所有查询在5.7和8.0测试通过

2. **建表语句获取**
   - 智能识别SHOW CREATE TABLE返回的列名
   - 兼容不同版本的列名差异（Create Table / CREATE TABLE）

3. **SQL语句处理**
   - 所有表名使用反引号包裹
   - 防止保留字冲突

## 后端部署

### 1. 文件清单

新增文件：
```
backed/src/main/java/com/knowledge/
  ├── mapper/DatabaseManagementMapper.java
  ├── service/DatabaseManagementService.java
  ├── service/impl/DatabaseManagementServiceImpl.java
  └── controller/DatabaseManagementController.java

backed/src/main/resources/mapper/
  └── DatabaseManagementMapper.xml
```

### 2. 编译打包

```bash
cd backed
mvn clean package -DskipTests
```

### 3. 部署到服务器

```bash
# 停止服务
./stop.sh

# 上传新的jar包
# knowledge-management-system-1.0.0.jar

# 启动服务
./start.sh

# 查看日志
tail -f logs/application.log
```

## 前端部署

### 1. 文件清单

新增/修改文件：
```
fronted/src/
  ├── api/dataManagement.ts （新增）
  ├── views/system/DataManagement.vue （新增）
  ├── router/index.ts （修改）
  └── components/Sidebar.vue （修改）
```

### 2. 构建

```bash
cd fronted
npm install  # 如果需要
npm run build
```

### 3. 部署到服务器

```bash
# 上传dist目录到服务器
scp -r dist/* user@server:/www/wwwroot/knowledge-frontend/

# 或使用现有的部署脚本
```

## 功能说明

### 访问权限

- **仅admin用户可访问**
- 三层权限验证：
  1. 路由守卫（前端）
  2. API权限验证（后端）
  3. UI菜单隐藏（仅admin可见）

### 表结构管理

左侧表列表：
- 显示数据库所有表
- 支持搜索过滤
- 点击选择表

右侧表详情：
- 查看表信息（引擎、字符集、记录数等）
- 查看列结构（列名、类型、注释、键信息）
- 操作：
  - ✅ 新建表（执行CREATE TABLE语句）
  - ✅ 查看建表SQL
  - ✅ 添加列
  - ✅ 修改列
  - ✅ 删除列
  - ✅ 重命名表
  - ✅ 删除表（需要二次确认）

### 数据管理

- 选择表查看数据
- 支持分页（默认20条/页）
- 操作：
  - ✅ 新增记录（动态表单）
  - ✅ 编辑记录（自动识别主键）
  - ✅ 删除记录

### 安全措施

1. **权限控制**
   - 只有admin用户可以访问
   - 每个API接口都验证Token和用户身份

2. **表保护**
   - sys_user表不允许删除
   - 删除表需要输入表名确认

3. **SQL注入防护**
   - 表名白名单验证（必须实际存在）
   - 禁止危险SQL关键字
   - 使用参数化查询
   - 表名和列名格式验证

## 使用方法

1. 使用admin账号登录系统
2. 点击侧边栏"系统配置" > "数据管理"
3. 切换Tab选择功能：
   - **表结构管理**：管理表结构
   - **数据管理**：管理表数据

## 常见问题

### Q1: 看不到任何表？

检查：
1. 确认使用admin账号登录
2. 打开浏览器控制台Network标签，检查`/api/database/tables`接口响应
3. 检查后端日志是否有错误
4. 确认数据库连接正常

### Q2: 正式环境和本地环境显示不一致？

已兼容MySQL 5.7和8.0，如果遇到问题：
1. 检查MySQL版本：`SELECT VERSION();`
2. 查看后端日志错误信息
3. 确认information_schema表权限

### Q3: 无法编辑某个表的数据？

可能原因：
- 该表没有主键
- 解决方案：先给表添加主键列

## 技术架构

### 后端

- **MyBatis动态SQL**：执行原生SQL和DDL语句
- **information_schema**：查询数据库元数据
- **Map<String, Object>**：处理动态表结构

### 前端

- **Vue 3 + TypeScript**
- **动态表格**：根据表结构自动生成列
- **动态表单**：根据列信息自动生成表单字段
- **Tab切换**：分离表结构和数据管理

## 版本信息

- **创建日期**：2025-11-11
- **MySQL支持**：5.7 和 8.0
- **Java版本**：8+
- **Node版本**：14+











