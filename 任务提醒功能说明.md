# 任务提醒功能实现说明

## 📋 功能概述

在以下4个页面添加了紧急任务提醒功能，当任务已过期或截止日期在5天内且未完成时，会在页面顶部显示醒目的提醒卡片。

## 🎯 实现页面

1. **总览面板** (Dashboard.vue)
2. **战争行动** (DefenseProjectsDashboard.vue)
3. **工程建设** (ConstructionProjectsDashboard.vue)
4. **外交行动** (DiplomaticProjectsDashboard.vue)

## ⚙️ 功能特性

### 1. 任务筛选条件
- ✅ 已过期 **或** 截止日期在 **5天内**（包括今天）
- ✅ 任务状态**不是**已完成（completed）
- ✅ 任务状态**不是**已停止（stopped）
- ✅ 必须有截止日期

### 2. 视觉设计

#### 紧急程度分级
- **🔥 已过期**：
  - 深红色左边框
  - 红色背景（整个卡片）
  - 深红色白字标签
  - 火焰图标 🔥
  - 文字："已逾期X天"
  - 深红色"立即处理"按钮

- **🔴 极紧急**（≤2天到期）：
  - 红色左边框
  - 红色背景标签
  - 文字："今天到期" / "明天到期" / "还剩X天"

- **🟠 紧急**（3-5天到期）：
  - 橙色左边框
  - 橙色背景标签
  - 文字："还剩X天"

#### 整体样式
- 橙红渐变背景
- 橙色左侧粗边框
- 警告图标（感叹号三角形）
- 悬停时显示阴影效果

### 3. 显示信息
每个任务卡片显示：
- ✅ 任务名称
- ✅ 剩余天数标签（颜色编码）
- ✅ 项目名称标签（仅总览面板）
- ✅ 任务描述
- ✅ 截止时间
- ✅ 创建时间（仅总览面板）
- ✅ "立即处理"按钮（仅总览面板，点击跳转到项目执行页面）

### 4. 排序规则
按剩余天数**升序**排列，已过期的任务（负数天数）会自动排在最前面，越紧急的任务排位越靠前

## 💻 技术实现

### 核心逻辑（computed属性）

```typescript
const urgentTasks = computed(() => {
  const now = new Date()
  const fiveDaysLater = new Date(now.getTime() + 5 * 24 * 60 * 60 * 1000)
  
  return tasks.value
    .filter(task => {
      // 排除已完成和已停止的任务
      if (task.status === 'completed' || task.status === 'stopped') return false
      
      // 检查截止时间
      if (!task.deadline) return false
      
      const deadline = new Date(task.deadline)
      // 已过期或在5天内到期
      return deadline <= fiveDaysLater
    })
    .map(task => {
      const deadline = new Date(task.deadline)
      const timeDiff = deadline.getTime() - now.getTime()
      const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24))
      
      return {
        ...task,
        daysLeft,
        isOverdue: deadline < now // 标记是否已过期
      }
    })
    .sort((a, b) => a.daysLeft - b.daysLeft) // 按剩余天数排序（过期的会排在最前面，因为是负数）
})
```

### 条件渲染

```vue
<div v-if="urgentTasks.length > 0" class="...">
  <!-- 只有当有紧急任务时才显示提醒区域 -->
</div>
```

## 🎨 样式细节

### 渐变背景
```css
background: linear-gradient(to right, from-orange-50, to-red-50);
```

### 边框和背景颜色动态绑定
```vue
:class="{
  'border-red-600 bg-red-50': task.isOverdue,
  'border-red-500': !task.isOverdue && task.daysLeft <= 2,
  'border-orange-500': !task.isOverdue && task.daysLeft > 2 && task.daysLeft <= 5
}"
```

### 标签颜色动态绑定
```vue
:class="{
  'bg-red-600 text-white': task.isOverdue,
  'bg-red-100 text-red-700': !task.isOverdue && task.daysLeft <= 2,
  'bg-orange-100 text-orange-700': !task.isOverdue && task.daysLeft > 2 && task.daysLeft <= 5
}"
```

### 按钮颜色动态绑定（总览面板）
```vue
:class="{
  'bg-red-600 hover:bg-red-700': task.isOverdue,
  'bg-blue-600 hover:bg-blue-700': !task.isOverdue
}"
```

## 📊 使用场景

### 总览面板（新设计）
- 显示**所有项目**的紧急任务
- **按三个行动组分类显示**：战争行动、工程建设、外交行动
- **支持折叠/展开**：点击分类标题可展开查看详情，默认折叠节省空间
- 每个分类显示紧急任务数量
- 提供"立即处理"按钮快速跳转
- 显示项目名称便于识别
- 分类图标和颜色：
  - 战争行动：红色 🎯
  - 工程建设：蓝色 🔨
  - 外交行动：绿色 🤝

### 各行动页面
- 只显示**该分类下**的紧急任务
- 战争行动：仅显示defense类别项目的任务
- 工程建设：仅显示construction类别项目的任务
- 外交行动：仅显示diplomatic类别项目的任务
- 默认全部展开显示

## ✨ 用户体验优化

1. **自动刷新**：
   - 页面激活时（通过`onActivated`）自动重新计算
   - 确保显示最新的任务状态

2. **视觉层次**：
   - 渐变背景吸引注意力
   - 左侧粗边框强调紧急程度
   - 颜色编码快速识别

3. **信息完整**：
   - 一目了然的剩余时间
   - 清晰的任务描述
   - 明确的截止日期

4. **快速操作**：
   - 总览面板提供直达按钮
   - 减少用户操作步骤

5. **分类折叠**（总览面板新功能）：
   - 默认折叠，避免页面过长
   - 点击分类标题即可展开/收起
   - 显示每个分类的任务数量
   - 有任务的分类才会显示
   - 折叠图标动态变化（上/下箭头）

## 🔄 数据流

### 总览面板数据流
```
任务列表（tasks）
    ↓
筛选（已过期或5天内 + 未完成）
    ↓
计算剩余天数 + 标记是否过期 + 添加分类标记
    ↓
按天数排序（过期任务自动排前面）
    ↓
urgentTasks（计算属性）
    ↓
按分类分组（defense/construction/diplomatic）
    ↓
urgentTasksByCategory（计算属性）
    ↓
根据过期状态应用不同样式
    ↓
按分类渲染可折叠卡片
```

### 各行动页面数据流
```
任务列表（tasks）
    ↓
筛选（已过期或5天内 + 未完成 + 该分类）
    ↓
计算剩余天数 + 标记是否过期
    ↓
按天数排序
    ↓
urgentTasks（计算属性）
    ↓
根据过期状态应用不同样式
    ↓
直接渲染任务卡片
```

## 📱 响应式设计

- 移动端：垂直堆叠，自适应宽度
- 桌面端：保持良好的间距和排版
- 所有尺寸都使用Tailwind CSS响应式单位

## 🎯 测试建议

1. 创建一个已过期的任务（如昨天或前天的截止日期），验证它显示为红色背景带火焰图标
2. 创建一个截止日期在明天的任务，验证显示红色标签
3. 创建一个截止日期在5天后的任务，验证显示橙色标签
4. 创建一个截止日期在7天后的任务（不应显示）
5. 切换到各个行动页面，验证任务分类正确
6. 完成一个任务，验证它从提醒列表中消失
7. 停止一个任务，验证它从提醒列表中消失
8. 验证已过期任务排在最前面

## 📝 注意事项

- 所有时间计算使用本地时间
- 剩余天数向上取整（`Math.ceil`）
- 已过期任务的剩余天数为负数，使用`Math.abs()`显示绝对值
- 已完成和已停止的任务不会出现在提醒中
- 没有设置截止日期的任务不会出现在提醒中
- 已过期的任务会优先显示在列表顶部（因为负数在排序时自然排在前面）
