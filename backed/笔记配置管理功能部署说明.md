# 笔记配置管理功能部署说明

## 功能概述

本次更新为所有笔记类型添加了完整的配置管理系统，支持自定义分类、主题、科目等配置的增删改查功能。

## 数据库初始化

### 1. 执行 SQL 脚本

请执行以下 SQL 脚本文件创建配置表并初始化数据：

```bash
backed/src/main/resources/db/km_note_config.sql
```

### 2. SQL 脚本内容说明

该脚本包含：
- **表结构创建**：`km_note_config` 表（带 km 前缀）
- **碎片笔记默认分类数据**：7个预设分类（DevOps、学习、思考、技术、生活、职场、项目管理）
- **碎片笔记默认主题数据**：17个预设主题（个人成长、代码质量、前端技术等）

### 3. 表结构说明（兼容 MySQL 5.7）

```sql
CREATE TABLE `km_note_config` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `note_type` VARCHAR(20) NOT NULL COMMENT '笔记类型：fragment-碎片,study-学习,memorization-背诵,exercise-刷题,practical-实战,framework-框架',
  `config_type` VARCHAR(20) NOT NULL COMMENT '配置类型：category-分类,theme-主题,subject-科目等',
  `config_name` VARCHAR(50) NOT NULL COMMENT '配置名称',
  `sort_order` INT(11) DEFAULT 999 COMMENT '排序序号',
  `rec_creator` VARCHAR(50) NOT NULL COMMENT '创建人',
  `rec_create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `rec_revisor` VARCHAR(50) DEFAULT NULL COMMENT '修订人',
  `rec_revise_time` DATETIME DEFAULT NULL COMMENT '修订时间',
  `arch_flag` INT(1) DEFAULT 0 COMMENT '归档标志:0-未归档,1-已归档',
  PRIMARY KEY (`id`),
  KEY `idx_creator` (`rec_creator`),
  KEY `idx_note_type` (`note_type`),
  KEY `idx_config_type` (`config_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笔记配置表';
```

**MySQL 5.7 兼容性说明：**
- 使用 `DATETIME` 而非 `TIMESTAMP` 避免默认值问题
- `rec_update_time` 不使用 `ON UPDATE CURRENT_TIMESTAMP`（在代码中通过 NOW() 更新）
- 字符集使用 `utf8mb4` 支持中文和特殊字符

## 支持的笔记类型

| 笔记类型 | 类型代码 | 配置示例 |
|---------|---------|---------|
| 碎片笔记 | fragment | category（分类）、theme（主题） |
| 学习笔记 | study | subject（科目）、course（课程） |
| 背诵笔记 | memorization | subject（科目）、knowledgePoint（知识点） |
| 刷题笔记 | exercise | subject（科目）、difficulty（难度） |
| 实战笔记 | practical | domain（领域）、techStack（技术栈） |
| 框架笔记 | framework | category（分类）、framework（框架） |

## 后端文件清单

### 新增文件

1. **实体类**
   - `backed/src/main/java/com/knowledge/entity/NoteConfig.java`

2. **Mapper 层**
   - `backed/src/main/java/com/knowledge/mapper/NoteConfigMapper.java`
   - `backed/src/main/resources/mapper/NoteConfigMapper.xml`

3. **Service 层**
   - `backed/src/main/java/com/knowledge/service/NoteConfigService.java`

4. **Controller 层**
   - `backed/src/main/java/com/knowledge/controller/NoteConfigController.java`

5. **数据库脚本**
   - `backed/src/main/resources/db/km_note_config.sql`

## 前端文件清单

### 新增文件

1. **API 接口**
   - `fronted/src/api/noteConfig.ts`

### 修改文件

1. **碎片笔记页面**
   - `fronted/src/views/materials/FragmentNotes.vue`
   - 添加了配置管理界面
   - 实现了增删改查功能

## API 接口说明

### 基础路径
```
/api/note-config
```

### 接口列表

1. **获取所有配置**
   - 方法：`GET`
   - 路径：`/list`
   - 返回：所有笔记类型的配置

2. **根据笔记类型获取配置**
   - 方法：`GET`
   - 路径：`/note-type/{noteType}`
   - 参数：`noteType` (fragment | study | memorization | exercise | practical | framework)
   - 返回：指定笔记类型的所有配置

3. **根据笔记类型和配置类型获取配置**
   - 方法：`GET`
   - 路径：`/note-type/{noteType}/config-type/{configType}`
   - 参数：
     - `noteType`: 笔记类型
     - `configType`: 配置类型（category, theme, subject等）
   - 返回：精确匹配的配置列表

4. **创建配置**
   - 方法：`POST`
   - 路径：`/`
   - 请求体：`{ noteType, configType, configName }`
   - 返回：创建的配置对象

5. **更新配置**
   - 方法：`PUT`
   - 路径：`/`
   - 请求体：`{ id, noteType, configType, configName, sortOrder }`
   - 返回：更新后的配置对象

6. **删除配置**
   - 方法：`DELETE`
   - 路径：`/{id}`
   - 参数：配置ID
   - 返回：删除结果

## 功能特性

### 1. 通用性设计

- 所有笔记类型共用一个配置表
- 通过 `note_type` 字段区分不同笔记类型
- 通过 `config_type` 字段区分不同配置类型（分类、主题、科目等）
- 易于扩展到其他笔记类型

### 2. 配置管理界面

- 在碎片笔记页面添加了专门的配置管理区域
- 分类和主题分别显示在两列
- 支持直接在界面上编辑配置名称
- 提供添加和删除按钮

### 3. 数据验证

- 配置名称不能为空
- 同一笔记类型和配置类型下，配置名称不能重复
- 删除前需要用户确认

### 4. 用户体验优化

- 实时更新：修改后立即刷新数据
- 错误提示：操作失败时给出明确提示
- 数据隔离：每个用户的配置相互独立

## 部署步骤

1. **执行数据库脚本**
   ```bash
   mysql -u root -p knowledge_management < backed/src/main/resources/db/km_note_config.sql
   ```

2. **重启后端服务**
   ```bash
   cd backed
   mvn clean install
   mvn spring-boot:run
   ```

3. **前端无需额外操作**
   - 前端代码会自动编译
   - 刷新浏览器即可看到新功能

## 测试建议

### 1. 测试添加配置
   - 在碎片笔记页面点击"添加"按钮
   - 输入新的分类或主题名称
   - 验证是否成功添加

### 2. 测试修改配置
   - 点击配置名称进行编辑
   - 修改后失焦保存
   - 验证是否成功更新

### 3. 测试删除配置
   - 点击删除按钮
   - 确认删除操作
   - 验证是否从列表中移除

### 4. 测试数据隔离
   - 使用不同用户登录
   - 验证各自的配置相互独立

### 5. 测试跨笔记类型
   - 未来可以为其他笔记类型（学习笔记、刷题笔记等）添加配置管理
   - 验证不同笔记类型的配置互不干扰

## 未来扩展

### 为其他笔记类型添加配置管理

以学习笔记为例，只需要：

1. **添加初始化数据**（可选）
   ```sql
   INSERT INTO `km_note_config` (`note_type`, `config_type`, `config_name`, `sort_order`, `rec_creator`) VALUES
   ('study', 'subject', '数学', 1, 'admin'),
   ('study', 'subject', '英语', 2, 'admin');
   ```

2. **在前端页面调用API**
   ```typescript
   // 在 StudyNotes.vue 中
   import { getConfigsByNoteType } from '@/api/noteConfig'
   
   const loadConfigs = async () => {
     const res = await getConfigsByNoteType('study')
     // 处理返回的配置数据
   }
   ```

3. **添加配置管理UI**（复用碎片笔记的UI组件）

## 注意事项

1. 本功能需要用户登录才能使用（JWT 认证）
2. 删除配置不会影响已有笔记中使用该配置的数据
3. 初始化的默认数据仅限 admin 用户，其他用户需自行添加
4. 建议定期备份 `km_note_config` 表数据
5. 表名使用 `km_` 前缀（knowledge management），遵循项目命名规范
6. SQL 脚本完全兼容 MySQL 5.7

## 版本信息

- 版本号：v1.5.0
- 更新日期：2025-10-08
- 开发者：system
- 兼容性：MySQL 5.7+

