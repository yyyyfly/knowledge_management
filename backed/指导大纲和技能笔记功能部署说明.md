# 指导大纲和技能笔记功能部署说明

## 一、功能概述

本次更新包含两大功能模块：

### 1. 指导大纲功能（全新）
- 在主仪表盘下新增"指导大纲"页面
- 用于创建和管理学科知识体系
- 支持树形结构的思维导图编辑
- 支持学科分类和标签筛选

### 2. 技能笔记功能（从框架笔记改造）
- 将"框架笔记"改为"技能笔记"
- 调整字段结构，更适合技能学习场景
- 新增三个富文本字段：预期描述、思考总结、最终效果
- 移除原 content 字段在技能笔记中的使用

## 二、数据库更新

### 1. 指导大纲表（新建）

执行 SQL 文件：`backed/src/main/resources/db/create_guidance_outline_table.sql`

```bash
mysql -u root -p knowledge_management < backed/src/main/resources/db/create_guidance_outline_table.sql
```

**主要内容：**
- 创建 `km_guidance_outline` 表
- 初始化学科分类配置数据到 `km_note_config` 表

### 2. 技能笔记字段调整

执行 SQL 文件：`backed/src/main/resources/db/update_framework_to_skill.sql`

```bash
mysql -u root -p knowledge_management < backed/src/main/resources/db/update_framework_to_skill.sql
```

**主要更改：**
- `subject_type` → `skill_type`
- `knowledge_point` → `skill_point`
- `content` 字段允许 NULL
- 新增 `expected_description`、`thinking_summary`、`final_effect` 三个字段

### 3. 笔记配置数据更新

执行 SQL 文件：`backed/src/main/resources/db/update_note_config_for_skill.sql`

```bash
mysql -u root -p knowledge_management < backed/src/main/resources/db/update_note_config_for_skill.sql
```

**主要更改：**
- 配置类型从 `subjectType` 改为 `skillType`
- 配置类型从 `knowledgePoint` 改为 `skillPoint`
- 更新配置名称以适配技能学习场景

## 三、后端更新文件清单

### 指导大纲相关
- `backed/src/main/java/com/knowledge/entity/GuidanceOutline.java`（新增）
- `backed/src/main/java/com/knowledge/mapper/GuidanceOutlineMapper.java`（新增）
- `backed/src/main/resources/mapper/GuidanceOutlineMapper.xml`（新增）
- `backed/src/main/java/com/knowledge/service/GuidanceOutlineService.java`（新增）
- `backed/src/main/java/com/knowledge/service/impl/GuidanceOutlineServiceImpl.java`（新增）
- `backed/src/main/java/com/knowledge/controller/GuidanceOutlineController.java`（新增）

### 技能笔记相关
- `backed/src/main/java/com/knowledge/entity/Note.java`（修改）
  - 字段改名：`subjectType` → `skillType`
  - 字段改名：`knowledgePoint` → `skillPoint`
  - 新增字段：`expectedDescription`、`thinkingSummary`、`finalEffect`
- `backed/src/main/resources/mapper/NoteMapper.xml`（修改）
  - 更新所有字段映射和 SQL 语句

## 四、前端更新文件清单

### 指导大纲相关
- `fronted/src/api/guidanceOutline.ts`（新增）
- `fronted/src/views/overview/GuidanceOutline.vue`（新增）
- `fronted/src/components/TreeNode.vue`（新增）
- `fronted/src/api/noteConfig.ts`（修改，新增 `getNoteConfigByType` 方法）
- `fronted/src/router/index.ts`（修改，新增路由）
- `fronted/src/components/Sidebar.vue`（修改，新增菜单项）

### 技能笔记相关
- `fronted/src/views/materials/SkillNotes.vue`（新增，替代 FrameworkNotes.vue）
- `fronted/src/services/noteService.ts`（修改）
  - 更新 Note 接口类型定义
  - 移除 `subject` 和 `subjectType` 数组处理
- `fronted/src/router/index.ts`（修改，路由指向 SkillNotes.vue）
- `fronted/src/components/Sidebar.vue`（修改，更新菜单名称和图标）

## 五、部署步骤

### 1. 数据库更新

按顺序执行以下 SQL 文件：

```bash
# 1. 创建指导大纲表
mysql -u root -p knowledge_management < backed/src/main/resources/db/create_guidance_outline_table.sql

# 2. 更新技能笔记字段
mysql -u root -p knowledge_management < backed/src/main/resources/db/update_framework_to_skill.sql

# 3. 更新笔记配置数据
mysql -u root -p knowledge_management < backed/src/main/resources/db/update_note_config_for_skill.sql
```

### 2. 后端部署

```bash
cd backed
mvn clean package
# 重启后端服务
```

### 3. 前端部署

```bash
cd fronted
npm install  # 如有新依赖
npm run build
# 部署 dist 目录到服务器
```

## 六、功能验证

### 1. 指导大纲功能

1. 登录系统后，点击侧边栏"主仪表盘" → "指导大纲"
2. 点击"新增学科"按钮，创建一个学科
3. 选择学科后，在右侧编辑器中添加知识树节点
4. 测试节点的增删改查功能
5. 测试保存功能

### 2. 技能笔记功能

1. 点击侧边栏"储备积累" → "素材积累" → "技能笔记"
2. 查看笔记列表是否正常显示
3. 点击笔记查看详情，确认显示三个新字段：
   - 预期描述
   - 思考总结
   - 最终效果
4. 测试巩固功能是否正常

### 3. 配置管理

1. 访问笔记配置管理
2. 确认 `guidance` 类型的 `subjectCategory` 配置存在
3. 确认 `framework` 类型的配置已更新为 `skillType` 和 `skillPoint`

## 七、注意事项

1. **数据备份**：执行 SQL 更新前，请先备份数据库
2. **字段兼容**：原 `content` 字段保留但允许 NULL，不影响其他笔记类型
3. **路由不变**：技能笔记的路由路径保持为 `/framework-notes`，确保兼容性
4. **旧数据迁移**：现有框架笔记的数据会自动使用新字段名

## 八、回滚方案

如需回滚，执行以下操作：

### 数据库回滚

```sql
-- 1. 删除指导大纲表
DROP TABLE IF EXISTS km_guidance_outline;

-- 2. 恢复技能笔记字段
ALTER TABLE km_note CHANGE COLUMN skill_type subject_type VARCHAR(500);
ALTER TABLE km_note CHANGE COLUMN skill_point knowledge_point VARCHAR(500);
ALTER TABLE km_note DROP COLUMN expected_description;
ALTER TABLE km_note DROP COLUMN thinking_summary;
ALTER TABLE km_note DROP COLUMN final_effect;

-- 3. 恢复笔记配置
UPDATE km_note_config SET config_type = 'subjectType' WHERE config_type = 'skillType';
UPDATE km_note_config SET config_type = 'knowledgePoint' WHERE config_type = 'skillPoint';
DELETE FROM km_note_config WHERE note_type = 'guidance';
```

### 代码回滚

使用 Git 恢复到更新前的版本。

## 九、联系方式

如遇问题，请联系开发团队。

