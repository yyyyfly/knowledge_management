# 主题管理快速部署指南

## 🚀 快速部署（5分钟）

### 第一步：执行数据库脚本
```bash
# 登录MySQL
mysql -u root -p

# 选择数据库
use knowledge_management;

# 执行建表脚本
source D:/项目本地/个人知识管理系统/backed/src/main/resources/db/km_topic.sql;

# 验证表是否创建成功
SHOW TABLES LIKE 'km_topic';
DESC km_topic;
SELECT * FROM km_topic;
```

**预期结果**：
- 看到 `km_topic` 表
- 表中有2条示例数据（km-system, vue-learning）

---

### 第二步：重启后端服务

#### 如果使用IDE（推荐）
1. 停止当前运行的Spring Boot应用
2. 重新运行 `KnowledgeManagementApplication`

#### 如果使用命令行
```bash
# 进入后端目录
cd backed

# 重新编译
mvn clean compile

# 重新打包
mvn package

# 重启服务
java -jar target/knowledge-management-system-1.0.0.jar
```

---

### 第三步：验证功能

#### 1. 测试主题API
```bash
# 获取所有主题
curl http://localhost:8080/timeline/topics

# 预期返回：
{
  "code": 200,
  "data": [
    {"id": "km-system", "name": "知识管理系统", ...},
    {"id": "vue-learning", "name": "Vue3学习路线", ...}
  ]
}
```

#### 2. 前端测试
1. 访问：`http://localhost:5173/daily/daily-summary`
2. 切换到"历史事件记录" > "专项时间轴里程碑"
3. 点击"新建主题"
4. 输入主题名称，点击"确认"
5. 验证提示："✅ 新主题已创建并保存到数据库"
6. **刷新页面**，验证主题仍然存在 ✅

---

## 📋 文件清单

### 新增文件（需要添加到版本控制）
```
backed/src/main/resources/db/
└── km_topic.sql                         ✅ 数据库脚本

backed/src/main/java/com/knowledge/
├── entity/Topic.java                    ✅ 实体类
├── mapper/TopicMapper.java              ✅ Mapper接口
└── service/TopicService.java            ✅ Service层

backed/src/main/resources/mapper/
└── TopicMapper.xml                      ✅ MyBatis配置
```

### 修改文件
```
backed/src/main/java/com/knowledge/
├── controller/TimelineEventController.java  ✅ 新增3个接口
└── service/TimelineEventService.java        ✅ 优化里程碑查询

fronted/src/views/daily/
└── DailySummary.vue                         ✅ 新增API调用
```

---

## ⚡ 常见问题

### Q1: 提示"创建失败：Table 'km_topic' doesn't exist"
**原因**：未执行数据库脚本  
**解决**：执行第一步的SQL脚本

### Q2: 主题保存后刷新页面消失
**原因**：后端未重启或编译失败  
**解决**：
```bash
cd backed
mvn clean compile
# 重启后端服务
```

### Q3: 控制台报错"Cannot find bean TopicMapper"
**原因**：MyBatis未扫描到新的Mapper  
**解决**：
1. 检查 `TopicMapper.java` 有 `@Mapper` 注解
2. 检查 `TopicMapper.xml` 在 `resources/mapper/` 目录下
3. 重启后端服务

### Q4: 删除主题后里程碑还在
**原因**：未执行级联删除  
**解决**：检查 `TimelineEventController.deleteTopic()` 方法

---

## 🔍 验证检查清单

- [ ] 数据库中存在 `km_topic` 表
- [ ] `km_topic` 表中有示例数据
- [ ] 后端服务成功启动，无错误日志
- [ ] 访问 `/timeline/topics` 返回主题列表
- [ ] 前端可以加载主题到下拉框
- [ ] 点击"确认"后提示成功
- [ ] 刷新页面主题依然存在
- [ ] 删除主题功能正常

---

## 📞 技术支持

如果遇到问题，请检查：
1. MySQL数据库连接正常
2. 后端服务正常运行（端口8080）
3. 前端服务正常运行（端口5173）
4. 查看后端控制台日志
5. 查看浏览器开发者工具的Network和Console

---

## ✅ 完成标志

当您能够：
1. ✅ 创建新主题并看到成功提示
2. ✅ 刷新页面后主题依然存在
3. ✅ 在数据库中查到主题数据
4. ✅ 删除主题并确认数据库中已删除

**恭喜！主题管理功能部署完成！** 🎉

