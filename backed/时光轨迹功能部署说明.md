# 时光轨迹功能部署说明

## 数据库部署

### 1. 执行SQL文件
```bash
# 连接到MySQL数据库（5.7版本）
mysql -u your_username -p

# 选择数据库
use knowledge_management;

# 执行SQL文件
source backed/src/main/resources/db/km_timeline_event.sql;
```

### 2. 验证表创建
```sql
-- 查看表结构
DESCRIBE km_timeline_event;

-- 查看示例数据
SELECT * FROM km_timeline_event;
```

## 后端部署

### 1. 确认文件已创建
- ✅ `backed/src/main/java/com/knowledge/entity/TimelineEvent.java`
- ✅ `backed/src/main/java/com/knowledge/mapper/TimelineEventMapper.java`
- ✅ `backed/src/main/resources/mapper/TimelineEventMapper.xml`
- ✅ `backed/src/main/java/com/knowledge/service/TimelineEventService.java`
- ✅ `backed/src/main/java/com/knowledge/controller/TimelineEventController.java`

### 2. 重启后端服务
```bash
# 如果使用Maven
mvn clean package
java -jar target/knowledge-management.jar

# 或使用IDE直接运行
```

## 前端部署

### 1. 前端代码已更新
- ✅ `fronted/src/views/daily/DailySummary.vue` - 历史事件保存
- ✅ `fronted/src/views/overview/TimelineReview.vue` - 时光轨迹展示

### 2. 重启前端服务
```bash
cd fronted
npm run dev
```

## API接口说明

### 1. 创建全局历史事件
```http
POST /timeline/global
Content-Type: application/json

{
  "title": "完成某个功能",
  "description": "详细描述",
  "date": "2025-10-08"
}
```

### 2. 创建专项时间轴里程碑
```http
POST /timeline/milestone
Content-Type: application/json

{
  "topicId": "km-system",
  "topicName": "个人知识管理系统开发",
  "title": "完成某个里程碑",
  "description": "详细描述",
  "date": "2025-10-08"
}
```

### 3. 获取全局历史事件
```http
GET /timeline/global
```

### 4. 获取专项时间轴里程碑
```http
GET /timeline/milestones
```

### 5. 删除事件
```http
DELETE /timeline/{id}
```

## 功能测试

### 1. 测试添加全局历史事件
1. 进入「每日总结」页面
2. 填写「历史事件记录」表单
3. 选择「全局历史事件」
4. 填写标题、描述、日期
5. 点击「添加到时间轴」
6. 前往「驾驶舱 > 时光轨迹」查看

### 2. 测试添加专项里程碑
1. 进入「每日总结」页面
2. 填写「历史事件记录」表单
3. 选择「专项时间轴」
4. 填写主题、标题、描述、日期
5. 点击「添加到时间轴」
6. 前往「驾驶舱 > 时光轨迹」查看

### 3. 测试数据展示
1. 进入「驾驶舱 > 时光轨迹」页面
2. 切换「全局历史」和「专项时间轴」视图
3. 查看按年/按月分组的事件
4. 查看不同主题的里程碑

### 4. 测试删除功能
1. 在时光轨迹页面
2. 鼠标悬停在事件卡片上
3. 点击右上角删除按钮
4. 确认删除

## 常见问题

### 1. 数据不显示
- 检查后端服务是否正常运行
- 检查数据库连接是否正常
- 查看浏览器控制台是否有错误
- 检查API响应是否正常（F12 > Network）

### 2. 日期格式错误
- 确保前端传递的日期格式为 `yyyy-MM-dd`
- 后端会自动转换为MySQL的DATE类型

### 3. 中文乱码
- 确保数据库表使用 `utf8mb4` 字符集
- 检查后端配置的数据库连接字符集

## 数据库字段说明

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| event_type | VARCHAR(20) | 事件类型：global/milestone |
| title | VARCHAR(200) | 事件标题 |
| description | TEXT | 事件描述 |
| event_date | DATE | 事件日期 |
| topic_id | VARCHAR(50) | 主题ID（仅milestone使用） |
| topic_name | VARCHAR(100) | 主题名称（仅milestone使用） |
| rec_creator | VARCHAR(50) | 创建人 |
| rec_create_time | DATETIME | 创建时间 |
| rec_revisor | VARCHAR(50) | 修订人 |
| rec_revise_time | DATETIME | 修订时间 |
| arch_flag | CHAR(1) | 归档标志：0-已归档 1-未归档 |

## 后续优化建议

1. **用户权限控制**
   - 当前使用硬编码的 `admin` 用户
   - 后续应从Session或Token获取真实用户信息

2. **数据分页**
   - 当数据量增大时，考虑添加分页功能
   - 支持按时间范围查询

3. **数据导出**
   - 支持导出为Markdown或PDF格式
   - 生成个人成长报告

4. **统计分析**
   - 事件数量统计
   - 成长曲线图表
   - 主题进度分析

