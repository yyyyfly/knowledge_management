# 日历管理功能部署说明

## 📅 功能概述

在系统决策页面新增"重要日期"管理模块，支持：
- 自定义重要日期记录
- 多种重复类型（单次、每天、每月、每年）
- 自动显示中国法定节假日
- 颜色标记和事件描述

## 🎯 功能特点

### 1. 重要日期管理
- **添加日期**：记录生日、纪念日、项目节点等重要日期
- **重复设置**：
  - 📅 单次：只发生一次的事件
  - 🔄 每天：每天重复（如每日站会）
  - 📆 每月：每月同一天重复（如月度汇报）
  - 🎂 每年：每年同一天重复（如生日）
- **颜色标记**：8种颜色可选，方便分类
- **事件描述**：可添加备注说明

### 2. 节假日显示
- 自动获取中国法定节假日和传统节日
- 显示未来6个即将到来的节假日
- 区分"法定假日"和"节日"
- 使用免费API，无需额外配置

### 3. UI设计
- 🟢 **翡翠绿渐变**：与其他区域（蓝色、橙色）区分
- 折叠式设计：节省空间
- 响应式布局：支持手机、平板、电脑

## 📁 文件清单

### 后端文件
1. **数据库表**
   - `backed/src/main/resources/db/km_calendar_event.sql`

2. **实体类**
   - `backed/src/main/java/com/knowledge/entity/CalendarEvent.java`

3. **Mapper层**
   - `backed/src/main/java/com/knowledge/mapper/CalendarEventMapper.java`
   - `backed/src/main/resources/mapper/CalendarEventMapper.xml`

4. **Service层**
   - `backed/src/main/java/com/knowledge/service/CalendarEventService.java`

5. **Controller层**
   - `backed/src/main/java/com/knowledge/controller/CalendarEventController.java`

### 前端文件
1. **页面修改**
   - `fronted/src/views/headquarters/SystemDecisions.vue`
     - 新增"重要日期"区域（第12-102行）
     - 新增添加/编辑弹窗（第501-614行）
     - 新增日历相关逻辑（第891-1053行）

## 🚀 部署步骤

### 1. 数据库部署
执行以下SQL创建日历事件表：

```sql
-- 执行 backed/src/main/resources/db/km_calendar_event.sql
CREATE TABLE `km_calendar_event` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `event_title` VARCHAR(200) NOT NULL COMMENT '事件标题',
  `event_date` DATE NOT NULL COMMENT '事件日期',
  `event_type` VARCHAR(20) NOT NULL DEFAULT 'custom' COMMENT '事件类型：custom-自定义, holiday-节假日',
  `repeat_type` VARCHAR(20) NOT NULL DEFAULT 'once' COMMENT '重复类型：once-单次, daily-每天, monthly-每月, yearly-每年',
  `description` TEXT COMMENT '事件描述',
  `color` VARCHAR(20) DEFAULT '#3b82f6' COMMENT '事件颜色',
  `rec_creator` VARCHAR(64) NOT NULL DEFAULT 'system' COMMENT '创建人',
  `rec_create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `rec_revisor` VARCHAR(64) NOT NULL DEFAULT 'system' COMMENT '修订人',
  `rec_revise_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修订时间',
  `arch_flag` INT(1) NOT NULL DEFAULT 1 COMMENT '归档标志:0-已删除,1-正常',
  PRIMARY KEY (`id`),
  KEY `idx_event_date` (`event_date`),
  KEY `idx_event_type` (`event_type`),
  KEY `idx_repeat_type` (`repeat_type`),
  KEY `idx_arch_flag` (`arch_flag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='日历事件表';
```

### 2. 后端部署
1. 确保所有后端Java文件已添加到项目中
2. 重新编译后端项目
3. 重启后端服务

### 3. 前端部署
1. 前端文件已更新到 `SystemDecisions.vue`
2. 无需额外配置
3. 刷新浏览器即可看到新功能

### 4. 节假日API说明
- **API地址**：`https://timor.tech/api/holiday/year/{year}`
- **免费使用**：无需注册，无需密钥
- **数据来源**：中国法定节假日和传统节日
- **自动更新**：每年自动获取最新数据

## 📊 数据结构

### CalendarEvent 实体

| 字段 | 类型 | 说明 | 示例 |
|-----|------|-----|------|
| id | BIGINT | 主键ID | 1 |
| eventTitle | VARCHAR(200) | 事件标题 | "项目上线" |
| eventDate | DATE | 事件日期 | 2025-10-15 |
| eventType | VARCHAR(20) | 事件类型 | custom/holiday |
| repeatType | VARCHAR(20) | 重复类型 | once/daily/monthly/yearly |
| description | TEXT | 事件描述 | "版本2.0正式发布" |
| color | VARCHAR(20) | 事件颜色 | #3b82f6 |

### 重复类型说明

| 类型 | 值 | 说明 | 使用场景 |
|-----|---|------|---------|
| 单次 | once | 只发生一次 | 项目里程碑、会议等 |
| 每天 | daily | 每天重复 | 每日站会、打卡提醒 |
| 每月 | monthly | 每月同一天 | 月度汇报、还款日 |
| 每年 | yearly | 每年同一天 | 生日、纪念日 |

## 🎨 UI展示

### 页面布局
```
系统决策
├── 重要日期 [翡翠绿] ▼
│   ├── 节假日显示（最多6个）
│   └── 自定义事件列表
├── 项目管理 [靛蓝色] ▼
└── 问题处理 [玫瑰色] ▼
```

### 颜色选项
- 🔵 蓝色 `#3b82f6`
- 🟢 绿色 `#10b981`
- 🟡 黄色 `#f59e0b`
- 🔴 红色 `#ef4444`
- 🟣 紫色 `#8b5cf6`
- 🌸 粉色 `#ec4899`
- 🔷 青色 `#14b8a6`
- 🟠 橙色 `#f97316`

## 🔧 API接口

### 1. 创建事件
- **接口**：`POST /calendar`
- **请求体**：
  ```json
  {
    "eventTitle": "项目发布",
    "eventDate": "2025-10-15",
    "repeatType": "once",
    "description": "版本2.0上线",
    "color": "#3b82f6"
  }
  ```

### 2. 获取所有事件
- **接口**：`GET /calendar/list`
- **返回**：当前用户的所有事件

### 3. 更新事件
- **接口**：`PUT /calendar/{id}`
- **请求体**：同创建事件

### 4. 删除事件
- **接口**：`DELETE /calendar/{id}`

### 5. 按日期范围查询
- **接口**：`GET /calendar/range?startDate=2025-10-01&endDate=2025-10-31`

## ✅ 功能验证

### 测试步骤
1. ✅ 访问 `http://localhost:5173/system-decisions`
2. ✅ 看到"重要日期"区域（翡翠绿色）
3. ✅ 点击"添加日期"按钮
4. ✅ 填写表单：
   - 事件标题：测试事件
   - 事件日期：选择日期
   - 重复类型：选择一种
   - 颜色：选择一个
5. ✅ 提交后在列表中看到新事件
6. ✅ 点击"编辑"修改事件
7. ✅ 点击"删除"删除事件
8. ✅ 查看节假日显示（如果当前年份有未来的节假日）

### 验收标准
- [x] 能成功添加事件
- [x] 能编辑事件
- [x] 能删除事件
- [x] 重复类型正确显示
- [x] 颜色标记生效
- [x] 节假日自动显示
- [x] 折叠功能正常

## 💡 使用技巧

### 1. 项目管理场景
```
事件：项目发布
日期：2025-10-15
重复：单次
颜色：蓝色
```

### 2. 生日提醒
```
事件：张三生日
日期：1990-05-20（选择今年的日期）
重复：每年
颜色：粉色
```

### 3. 月度汇报
```
事件：月度总结
日期：每月1号
重复：每月
颜色：紫色
```

### 4. 每日任务
```
事件：每日站会
日期：任意工作日
重复：每天
颜色：绿色
```

## 🐛 常见问题

### Q1: 节假日不显示？
- **原因**：当前年份没有未来的节假日，或API访问失败
- **解决**：检查网络连接，确保能访问 `https://timor.tech`

### Q2: 日期格式错误？
- **原因**：浏览器日期选择器格式问题
- **解决**：使用标准日期选择器，格式为 `YYYY-MM-DD`

### Q3: 重复事件如何处理？
- **说明**：系统只存储原始日期，展示时根据重复规则计算
- **提示**：每年/每月重复的事件，选择基准日期即可

## 📈 后续优化

### 可扩展功能
1. **提醒功能**：提前N天提醒
2. **日历视图**：月历展示
3. **导出功能**：导出为iCal格式
4. **分类管理**：事件分类标签
5. **共享功能**：多人协作（如需要）

## 🎉 完成标志

- ✅ 数据库表创建成功
- ✅ 后端接口正常运行
- ✅ 前端页面正常显示
- ✅ 节假日API正常调用
- ✅ 所有功能验证通过

---

*部署时间：2025-10-09*  
*功能版本：v1.9.0+*  
*页面位置：系统决策 - 重要日期*

