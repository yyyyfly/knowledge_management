# ä¸ªäººçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ - å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚

- æ“ä½œç³»ç»Ÿï¼šLinux (Debian/Ubuntu/CentOS)
- JDKï¼š1.8+
- MySQLï¼š5.7+
- Nginxï¼š1.26+
- å®å¡”é¢æ¿ï¼šå·²å®‰è£…

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…å¿…è¦è½¯ä»¶ï¼ˆåœ¨å®å¡”é¢æ¿ï¼‰

1. **å®‰è£… OpenJDK 1.8**

   - è½¯ä»¶å•†åº— â†’ æœç´¢ "OpenJDK" â†’ å®‰è£… "OpenJDK 1.8"
2. **å·²å®‰è£…çš„è½¯ä»¶**ï¼ˆä½ å·²ç»å®‰è£…å¥½äº†ï¼‰

   - âœ“ MySQL 5.7.44
   - âœ“ Nginx 1.26.3
   - âœ“ phpMyAdmin 4.4

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç›®å½•ç»“æ„ï¼ˆSSHç»ˆç«¯ï¼‰

```bash
# åˆ›å»ºå‰ç«¯ç›®å½•ï¼ˆå¦‚æœæ·»åŠ ç½‘ç«™æ—¶æ²¡æœ‰è‡ªåŠ¨åˆ›å»ºï¼‰
mkdir -p /www/wwwroot/www.personalmanange.xyz

# åˆ›å»ºåç«¯ç›®å½•
mkdir -p /www/wwwroot/knowledge-backend/logs

# è®¾ç½®æƒé™
chmod -R 755 /www/wwwroot/www.personalmanange.xyz
chmod -R 755 /www/wwwroot/knowledge-backend
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ•°æ®åº“

1. **æ•°æ®åº“ä¿¡æ¯**ï¼ˆä½ å·²åˆ›å»ºï¼‰

   - æ•°æ®åº“åï¼š`knowledge_management` âœ“
   - ç”¨æˆ·åï¼š`knowledge_management` âœ“
   - å¯†ç ï¼šè®°å¾—ä½ è®¾ç½®çš„å¯†ç 
2. **å¯¼å…¥æ•°æ®åº“ç»“æ„**

   - è¿›å…¥å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ ç‚¹å‡» `knowledge_management` çš„"ç®¡ç†"
   - è¿›å…¥ phpMyAdmin
   - ç‚¹å‡»"SQL"æ ‡ç­¾
   - ä¾æ¬¡æ‰§è¡Œé¡¹ç›®ä¸­çš„SQLæ–‡ä»¶ï¼š
     - `backed/src/main/resources/db/schema.sql` ï¼ˆä¸»è¡¨ç»“æ„ï¼‰
     - `backed/src/main/resources/db/user-schema.sql` ï¼ˆç”¨æˆ·è¡¨ï¼‰
     - `backed/src/main/resources/db/data.sql` ï¼ˆæµ‹è¯•æ•°æ®ï¼Œå¯é€‰ï¼‰

### ç¬¬å››æ­¥ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶

1. **ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®**

   - ç¼–è¾‘ `backed/src/main/resources/application-prod.properties`
   - ä¿®æ”¹ç¬¬23è¡Œçš„æ•°æ®åº“å¯†ç ï¼š
     ```properties
     spring.datasource.password=ä½ åœ¨å®å¡”è®¾ç½®çš„æ•°æ®åº“å¯†ç 
     ```
2. **ä¿®æ”¹å‰ç«¯é…ç½®**

   - ç¼–è¾‘ `fronted/.env.production`
   - ä¿®æ”¹ç¬¬3è¡Œçš„æœåŠ¡å™¨åœ°å€ï¼š
     ```
     VITE_API_BASE_URL=http://ä½ çš„æœåŠ¡å™¨IP/api
     ```
   - å¦‚æœæœ‰åŸŸåï¼Œå¯ä»¥æ”¹æˆï¼š
     ```
     VITE_API_BASE_URL=http://ä½ çš„åŸŸå/api
     ```

### ç¬¬äº”æ­¥ï¼šæœ¬åœ°æ‰“åŒ…é¡¹ç›®

**æ‰“åŒ…åç«¯ï¼š**

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backed

# Mavenæ‰“åŒ…ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰
mvn clean package -DskipTests

# æ‰“åŒ…æˆåŠŸåï¼ŒjaråŒ…ä½ç½®ï¼šbacked/target/knowledge-management-system-1.0.0.jar
```

**æ‰“åŒ…å‰ç«¯ï¼š**

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd fronted

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
npm install

# æ‰“åŒ…
npm run build

# æ‰“åŒ…æˆåŠŸåï¼Œæ–‡ä»¶ä½ç½®ï¼šfronted/dist/
```

### ç¬¬å…­æ­¥ï¼šä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

**æ–¹å¼1ï¼šä½¿ç”¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨**

1. ç™»å½•å®å¡”é¢æ¿
2. ç‚¹å‡»"æ–‡ä»¶"
3. ä¸Šä¼ æ–‡ä»¶ï¼š
   - åç«¯ï¼šå°† `backed/target/knowledge-management-system-1.0.0.jar` ä¸Šä¼ åˆ° `/www/wwwroot/knowledge-backend/`
   - å‰ç«¯ï¼šå°† `fronted/dist/` ä¸­çš„æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ° `/www/wwwroot/www.personalmanange.xyz/`
   - è„šæœ¬ï¼šå°† `deploy/` ä¸­çš„ `.sh` æ–‡ä»¶ä¸Šä¼ åˆ° `/www/wwwroot/knowledge-backend/`

**æ–¹å¼2ï¼šä½¿ç”¨FTP**

- ä½¿ç”¨å®å¡”çš„FTPåŠŸèƒ½æˆ–ä»»æ„FTPå®¢æˆ·ç«¯
- è¿æ¥ä¿¡æ¯åœ¨å®å¡”é¢æ¿çš„FTPç®¡ç†ä¸­æŸ¥çœ‹

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½® Nginx

1. **æ·»åŠ ç½‘ç«™**

   - å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ æ·»åŠ ç«™ç‚¹
   - åŸŸåï¼š`www.personalmanange.xyz`
   - æ ¹ç›®å½•ï¼š`/www/wwwroot/www.personalmanange.xyz`
   - PHPç‰ˆæœ¬ï¼šçº¯é™æ€
   - æ•°æ®åº“ï¼šä¸åˆ›å»º
2. **ä¿®æ”¹Nginxé…ç½®**

   - ç‚¹å‡»ç½‘ç«™åé¢çš„"è®¾ç½®"
   - ç‚¹å‡»"é…ç½®æ–‡ä»¶"
   - å‚è€ƒ `deploy/nginx.conf` æ–‡ä»¶å†…å®¹ä¿®æ”¹é…ç½®
   - ä¸»è¦æ·»åŠ è¿™æ®µåˆ° `server` å—ä¸­ï¼š

   ```nginx
   location /api/ {
       proxy_pass http://localhost:8080/api/;
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
   }

   location / {
       try_files $uri $uri/ /index.html;
   }
   ```

   - ä¿å­˜å¹¶é‡è½½Nginx

### ç¬¬å…«æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

**SSHç»ˆç«¯æ“ä½œï¼š**

```bash
# è¿›å…¥åº”ç”¨ç›®å½•
cd /www/wwwroot/knowledge-backend

# èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
chmod +x start.sh stop.sh restart.sh

# å¯åŠ¨åº”ç”¨
./start.sh

# æŸ¥çœ‹æ—¥å¿—ï¼ˆæ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸï¼‰
tail -f logs/application.log
# æŒ‰ Ctrl+C é€€å‡ºæ—¥å¿—æŸ¥çœ‹
```

### ç¬¬ä¹æ­¥ï¼šæµ‹è¯•è®¿é—®

1. **è®¿é—®å‰ç«¯é¡µé¢**

   - æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://www.personalmanange.xyz` æˆ– `http://38.246.252.250`
2. **æµ‹è¯•ç™»å½•**

   - é»˜è®¤è´¦å·ï¼š`admin`
   - é»˜è®¤å¯†ç ï¼š`12345`
3. **æ£€æŸ¥æ§åˆ¶å°**

   - æŒ‰F12æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
   - æŸ¥çœ‹Networkæ ‡ç­¾ï¼Œæ£€æŸ¥APIè¯·æ±‚æ˜¯å¦æ­£å¸¸

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
./start.sh

# åœæ­¢æœåŠ¡
./stop.sh

# é‡å¯æœåŠ¡
./restart.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/application.log

# æŸ¥çœ‹è¿›ç¨‹
ps -ef | grep knowledge-management

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -anp | grep 8080
```

## ğŸ“ ç›®å½•ç»“æ„

```
/www/wwwroot/
â”œâ”€â”€ www.personalmanange.xyz/        # å‰ç«¯ç›®å½•ï¼ˆç½‘ç«™æ ¹ç›®å½•ï¼‰
â”‚   â”œâ”€â”€ index.html                 # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ assets/                    # é™æ€èµ„æº
â”‚       â”œâ”€â”€ *.js
â”‚       â”œâ”€â”€ *.css
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ knowledge-backend/              # åç«¯ç›®å½•ï¼ˆç‹¬ç«‹ç›®å½•ï¼‰
    â”œâ”€â”€ knowledge-management-system-1.0.0.jar  # åº”ç”¨jaråŒ…
    â”œâ”€â”€ start.sh                   # å¯åŠ¨è„šæœ¬
    â”œâ”€â”€ stop.sh                    # åœæ­¢è„šæœ¬
    â”œâ”€â”€ restart.sh                 # é‡å¯è„šæœ¬
    â”œâ”€â”€ app.pid                    # è¿›ç¨‹IDæ–‡ä»¶ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
    â””â”€â”€ logs/                      # æ—¥å¿—ç›®å½•
        â”œâ”€â”€ application.log        # åº”ç”¨æ—¥å¿—
        â””â”€â”€ app.log               # æ§åˆ¶å°è¾“å‡º
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é˜²ç«å¢™è®¾ç½®**

   - ç¡®ä¿æœåŠ¡å™¨å®‰å…¨ç»„/é˜²ç«å¢™å¼€æ”¾äº†ä»¥ä¸‹ç«¯å£ï¼š
     - 80 (HTTP)
     - 443 (HTTPSï¼Œå¦‚æœé…ç½®äº†SSL)
     - 8080 (åç«¯APIï¼Œä»…æœ¬åœ°è®¿é—®)
2. **æ•°æ®åº“é…ç½®**

   - ç¡®ä¿æ•°æ®åº“å¯†ç æ­£ç¡®
   - ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
3. **æ—¥å¿—æŸ¥çœ‹**

   - å¦‚æœå¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ’æŸ¥é—®é¢˜
   - åº”ç”¨æ—¥å¿—ï¼š`/www/wwwroot/knowledge-backend/logs/application.log`
   - æ§åˆ¶å°è¾“å‡ºï¼š`/www/wwwroot/knowledge-backend/logs/app.log`
4. **è·¨åŸŸé—®é¢˜**

   - é€šè¿‡Nginxä»£ç†åç«¯APIï¼Œå‰åç«¯ä½¿ç”¨åŒä¸€åŸŸåï¼Œä¸ä¼šæœ‰è·¨åŸŸé—®é¢˜
5. **æ›´æ–°éƒ¨ç½²**

   - é‡æ–°æ‰“åŒ…åï¼Œå…ˆåœæ­¢æœåŠ¡
   - ä¸Šä¼ æ–°çš„jaråŒ…è¦†ç›–æ—§æ–‡ä»¶
   - é‡æ–°å¯åŠ¨æœåŠ¡

## ğŸ”„ è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰

**æ–¹å¼1ï¼šä½¿ç”¨Supervisorï¼ˆæ¨èï¼‰**

1. å®å¡”è½¯ä»¶å•†åº—æœç´¢ "Supervisor" â†’ å®‰è£…
2. æ·»åŠ å®ˆæŠ¤è¿›ç¨‹ï¼š
   - åç§°ï¼š`knowledge-management`
   - è¿è¡Œç›®å½•ï¼š`/www/wwwroot/knowledge-backend`
   - å¯åŠ¨å‘½ä»¤ï¼š`java -jar knowledge-management-system-1.0.0.jar --spring.profiles.active=prod`
   - è¿›ç¨‹æ•°é‡ï¼š1

**æ–¹å¼2ï¼šä½¿ç”¨ç³»ç»ŸæœåŠ¡**

```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/knowledge-management.service

# æ·»åŠ å†…å®¹ï¼š
[Unit]
Description=Knowledge Management System
After=network.target

[Service]
Type=simple
User=www
WorkingDirectory=/www/wwwroot/knowledge-backend
ExecStart=/usr/bin/java -jar knowledge-management-system-1.0.0.jar --spring.profiles.active=prod
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target

# å¯ç”¨æœåŠ¡
sudo systemctl enable knowledge-management
sudo systemctl start knowledge-management
```

## ğŸ› å¸¸è§é—®é¢˜

**1. ç«¯å£8080è¢«å ç”¨**

```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i:8080
# æˆ–
netstat -anp | grep 8080

# æ€æ­»è¿›ç¨‹
kill -9 è¿›ç¨‹ID
```

**2. æ•°æ®åº“è¿æ¥å¤±è´¥**

- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥ç”¨æˆ·åã€å¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ•°æ®åº“æƒé™

**3. å‰ç«¯è®¿é—®404**

- æ£€æŸ¥Nginxé…ç½®ä¸­çš„ `try_files $uri $uri/ /index.html;`
- æ£€æŸ¥å‰ç«¯æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¸Šä¼ 

**4. APIè¯·æ±‚å¤±è´¥**

- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`ps -ef | grep java`
- æ£€æŸ¥8080ç«¯å£æ˜¯å¦ç›‘å¬ï¼š`netstat -anp | grep 8080`
- æ£€æŸ¥Nginxä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
2. æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—ï¼š`/www/wwwlogs/knowledge-management_error.log`
3. æ£€æŸ¥æœåŠ¡å™¨èµ„æºï¼š`top` æˆ– `htop`

---

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
