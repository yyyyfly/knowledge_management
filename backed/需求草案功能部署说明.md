# 需求草案管理功能部署说明（重新设计版）

## 功能概述

需求草案管理功能是一个灵感收集和需求管理工具。**一次只编辑一个版本**，在当前版本中反复增删改查，积累到一定程度后，可以将版本标记为"已通过"或"已废弃"，自动归档到历史记录中。

## 核心特性

1. **单版本编辑模式**：一次只编辑一个版本，专注于当前版本的需求整理
2. **版本状态管理**：草拟中（drafting）、已通过（approved）、已废弃（abandoned）
3. **版本归档**：已通过和已废弃的版本自动归档，可查看但不可编辑
4. **直接管理**：在需求列表中直接添加、编辑、删除需求
5. **草案图标**：使用 fa-file-contract 图标，更符合草案/合同的感觉

## 页面布局

### 顶部 - 当前编辑版本
- 显示当前版本号（可点击编辑修改）
- 显示需求数量
- "通过版本"按钮：将当前版本标记为已通过并归档
- "废弃版本"按钮：将当前版本标记为已废弃并归档

### 中间 - 需求列表
- 显示当前版本的所有需求
- 可展开查看详细描述
- 每条需求可以编辑和删除
- "添加需求"按钮：添加新需求到当前版本

### 底部 - 归档区
- 左侧：已通过的版本列表
- 右侧：已废弃的版本列表
- 点击可查看归档版本的所有需求（只读）

## 部署步骤

### 1. 执行数据库脚本

**如果是全新安装**，执行：
```bash
mysql -u root -p your_database < backed/src/main/resources/db/create_requirement_draft_table.sql
```

**如果是升级现有表**，执行：
```bash
mysql -u root -p your_database < backed/alter_requirement_draft_add_status.sql
```

或者手动执行SQL：

```sql
-- 添加status字段
ALTER TABLE km_requirement_draft 
ADD COLUMN status VARCHAR(20) DEFAULT 'drafting' COMMENT '版本状态：drafting-草拟中,approved-已通过,abandoned-已废弃' 
AFTER description;

-- 添加索引
ALTER TABLE km_requirement_draft ADD INDEX idx_status (status);

-- 更新现有数据
UPDATE km_requirement_draft SET status = 'drafting' WHERE status IS NULL OR status = '';
```

### 2. 重新编译后端

```bash
cd backed
mvn clean package
```

### 3. 重新构建前端

```bash
cd fronted
npm run build
```

### 4. 重启服务

```bash
# 重启后端服务
java -jar backed/target/knowledge-management-system-1.0.0.jar

# 开发模式
cd fronted
npm run dev
```

## API 接口说明

### 获取所有需求草案
- **URL**: `GET /requirement-draft/list`
- **返回**: 所有需求草案列表（包含所有状态）

### 创建需求草案
- **URL**: `POST /requirement-draft`
- **参数**: 
  ```json
  {
    "version": "v3.0",
    "title": "功能标题",
    "description": "详细描述（可选）",
    "status": "drafting"
  }
  ```

### 更新需求草案（包括状态变更）
- **URL**: `PUT /requirement-draft`
- **参数**:
  ```json
  {
    "id": 1,
    "version": "v3.0",
    "title": "更新的标题",
    "description": "更新的描述",
    "status": "approved"
  }
  ```

### 删除需求草案
- **URL**: `DELETE /requirement-draft/{id}`
- **参数**: id - 需求草案ID

## 使用说明

### 管理当前版本需求

1. **设置版本号**：点击顶部版本号进行编辑，输入如 v3.0 的版本号
2. **添加需求**：点击"添加需求"按钮，填写标题和描述
3. **编辑需求**：点击需求卡片上的编辑按钮
4. **删除需求**：点击需求卡片上的删除按钮
5. **查看详情**：点击需求卡片展开查看详细描述

### 版本状态管理

**通过版本**：
- 点击顶部"通过版本"按钮
- 确认后，当前版本的所有需求状态变为"已通过"
- 自动归档到"已通过"列表

**废弃版本**：
- 点击顶部"废弃版本"按钮
- 确认后，当前版本的所有需求状态变为"已废弃"
- 自动归档到"已废弃"列表

**查看归档**：
- 在底部归档区点击版本号
- 弹出对话框显示该版本的所有需求（只读）

### 工作流程示例

1. 设置版本号为 v3.0
2. 添加多个功能想法到需求列表
3. 不断编辑、删除、新增，反复整理
4. 积累到一定程度，觉得可以开发了
5. 点击"通过版本"，v3.0归档到已通过列表
6. 设置新版本号 v4.0，开始下一轮需求整理

## 数据库表结构

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键ID |
| version | VARCHAR(50) | 版本号 |
| title | VARCHAR(200) | 标题 |
| description | MEDIUMTEXT | 详细描述 |
| **status** | **VARCHAR(20)** | **版本状态（新增）** |
| sort_order | INT | 排序号 |
| rec_creator | VARCHAR(50) | 创建人 |
| rec_create_time | DATETIME | 创建时间 |
| rec_revisor | VARCHAR(50) | 修改人 |
| rec_revise_time | DATETIME | 修改时间 |
| arch_flag | INT | 归档标志 |

## 设计变更说明

### 移除的功能
- ❌ 快速输入区域（不符合使用场景）
- ❌ 多版本同时展示（容易混乱）
- ❌ 版本分组卡片（改为单版本编辑）

### 新增的功能
- ✅ 单版本编辑模式
- ✅ 版本状态管理（草拟中/已通过/已废弃）
- ✅ 版本归档区（分类展示已通过和已废弃的版本）
- ✅ 归档版本只读查看
- ✅ 更换图标为 fa-file-contract（更符合草案感觉）

### 核心理念
**专注单版本**：一次只整理一个版本的需求，避免分散精力。想法积累够了就归档，开始新版本。

## 页面位置

在系统导航栏中的位置：

```
主仪表盘
├── 总仪表盘
├── 时光轨迹
├── 指导大纲
├── 模拟实战
└── 需求草案 ← 新图标 fa-file-contract
```

访问路径：`/overview/requirement-draft`

## 注意事项

1. **版本号建议格式**：vX.Y（如 v3.0、v4.0），但不强制
2. **标题必填**：创建需求时必须填写标题，描述可选
3. **状态不可逆**：版本一旦通过或废弃，需求将无法再编辑（只能查看）
4. **逻辑删除**：删除操作是逻辑删除，数据不会真正从数据库移除
5. **权限控制**：需要登录后才能访问和操作

## 故障排查

### 版本归档后还显示在编辑区
- 检查数据库中status字段是否正确更新
- 确认前端过滤条件：`d.status === 'drafting'`

### 归档版本无法查看
- 检查数据是否存在
- 确认版本号匹配

### 状态更新失败
- 检查后端日志
- 确认Mapper XML中包含status字段

## 完成状态

✅ 数据库表添加status字段
✅ 后端实体类、Mapper、Service、Controller更新
✅ 前端页面完全重新设计
✅ 图标更换为 fa-file-contract
✅ 单版本编辑模式实现
✅ 版本状态管理和归档功能

功能已全部重新开发完成，可以直接部署使用！
