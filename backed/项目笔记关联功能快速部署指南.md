# é¡¹ç›®ç¬”è®°å…³è”åŠŸèƒ½ - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸš€ ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

### æ­¥éª¤1ï¼šæ•°æ®åº“éƒ¨ç½²

```bash
# 1. è¿æ¥åˆ°MySQLæ•°æ®åº“
mysql -u root -p knowledge_management

# 2. æ‰§è¡Œå»ºè¡¨è„šæœ¬
source backed/create_project_note_relation_table.sql

# 3. éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ
DESC project_note_relation;
```

**é¢„æœŸè¾“å‡ºï¼š**
```
+------------------+--------------+------+-----+-------------------+
| Field            | Type         | Null | Key | Default           |
+------------------+--------------+------+-----+-------------------+
| id               | int          | NO   | PRI | NULL              |
| project_id       | int          | NO   | MUL | NULL              |
| note_id          | int          | NO   |     | NULL              |
| note_type        | varchar(50)  | NO   | MUL | NULL              |
| rec_creator      | varchar(50)  | YES  |     | NULL              |
| rec_create_time  | datetime     | YES  |     | CURRENT_TIMESTAMP |
| rec_revisor      | varchar(50)  | YES  |     | NULL              |
| rec_revise_time  | datetime     | YES  |     | CURRENT_TIMESTAMP |
| arch_flag        | char(1)      | YES  |     | 1                 |
+------------------+--------------+------+-----+-------------------+
```

### æ­¥éª¤2ï¼šåç«¯éƒ¨ç½²

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backed

# æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
mvn clean package -DskipTests

# åœæ­¢æ—§æœåŠ¡ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
# ./stop.sh æˆ–æ‰‹åŠ¨åœæ­¢

# å¯åŠ¨æ–°æœåŠ¡
java -jar target/knowledge-management-system-1.0.0.jar
```

### æ­¥éª¤3ï¼šéªŒè¯éƒ¨ç½²

```bash
# æµ‹è¯•1ï¼šè·å–é¡¹ç›®1çš„å…³è”ç¬”è®°ï¼ˆåº”è¿”å›ç©ºæ•°ç»„ï¼‰
curl http://localhost:8080/project/1/notes

# æµ‹è¯•2ï¼šæ·»åŠ ç¬”è®°åˆ°é¡¹ç›®
curl -X POST http://localhost:8080/project/1/notes \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"noteId": 1, "noteType": "framework"}'

# æµ‹è¯•3ï¼šå†æ¬¡è·å–ï¼ˆåº”è¿”å›[1]ï¼‰
curl http://localhost:8080/project/1/notes
```

## âœ… éƒ¨ç½²éªŒè¯æ¸…å•

### æ•°æ®åº“éªŒè¯
- [ ] `project_note_relation` è¡¨å·²åˆ›å»º
- [ ] å”¯ä¸€ç´¢å¼• `uk_project_note` å·²åˆ›å»º
- [ ] æ™®é€šç´¢å¼• `idx_project`, `idx_note`, `idx_note_type` å·²åˆ›å»º
- [ ] é»˜è®¤å€¼æ­£ç¡®è®¾ç½®ï¼ˆ`arch_flag='1'`ï¼‰

### åç«¯éªŒè¯
- [ ] é¡¹ç›®ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] æ—¥å¿—ä¸­æ—  MyBatis æ˜ å°„é”™è¯¯
- [ ] API ç«¯ç‚¹å¯è®¿é—®

### åŠŸèƒ½éªŒè¯
- [ ] èƒ½æˆåŠŸæ·»åŠ ç¬”è®°åˆ°é¡¹ç›®
- [ ] èƒ½æŸ¥è¯¢é¡¹ç›®çš„å…³è”ç¬”è®°
- [ ] èƒ½åˆ é™¤ç¬”è®°å…³è”
- [ ] é‡å¤æ·»åŠ æ—¶è¿”å›æ­£ç¡®é”™è¯¯æç¤º
- [ ] åˆ é™¤ä¸å­˜åœ¨çš„å…³è”æ—¶æ­£ç¡®å¤„ç†

## ğŸ“‹ æ–°å¢æ–‡ä»¶æ¸…å•

### æ•°æ®åº“è„šæœ¬
- âœ… `backed/create_project_note_relation_table.sql` - å»ºè¡¨è„šæœ¬
- âœ… `backed/test_project_note_relation.sql` - æµ‹è¯•è„šæœ¬

### Javaæºä»£ç 
- âœ… `backed/src/main/java/com/knowledge/entity/ProjectNoteRelation.java`
- âœ… `backed/src/main/java/com/knowledge/mapper/ProjectNoteRelationMapper.java`
- âœ… `backed/src/main/java/com/knowledge/service/ProjectNoteRelationService.java`
- âœ… `backed/src/main/resources/mapper/ProjectNoteRelationMapper.xml`
- âœ… `backed/src/main/java/com/knowledge/controller/ProjectController.java` (å·²ä¿®æ”¹)

### æ–‡æ¡£
- âœ… `backed/é¡¹ç›®ç¬”è®°å…³è”åŠŸèƒ½éƒ¨ç½²è¯´æ˜.md`
- âœ… `backed/é¡¹ç›®ç¬”è®°å…³è”åŠŸèƒ½å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md` (æœ¬æ–‡ä»¶)

## ğŸ” APIæ¥å£å¿«é€Ÿå‚è€ƒ

### 1. è·å–é¡¹ç›®çš„ç¬”è®°IDåˆ—è¡¨
```http
GET /project/{projectId}/notes
```

### 2. æ·»åŠ ç¬”è®°åˆ°é¡¹ç›®
```http
POST /project/{projectId}/notes
Body: {"noteId": 5, "noteType": "framework"}
```

### 3. ä»é¡¹ç›®ç§»é™¤ç¬”è®°
```http
DELETE /project/{projectId}/notes/{noteId}
```

### 4. è·å–é¡¹ç›®çš„ç¬”è®°æ•°é‡
```http
GET /project/{projectId}/notes/count
```

### 5. è·å–ç¬”è®°å…³è”çš„é¡¹ç›®IDåˆ—è¡¨
```http
GET /project/notes/{noteId}/projects
```

## ğŸ› å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### Q1: è¡¨å·²å­˜åœ¨é”™è¯¯
```sql
-- åˆ é™¤æ—§è¡¨
DROP TABLE IF EXISTS project_note_relation;

-- é‡æ–°æ‰§è¡Œå»ºè¡¨è„šæœ¬
source backed/create_project_note_relation_table.sql;
```

### Q2: Mapperæ‰¾ä¸åˆ°
```bash
# ç¡®è®¤mapperé…ç½®
cat backed/src/main/resources/application.properties | grep mybatis.mapper

# åº”è¯¥è¾“å‡ºï¼š
# mybatis.mapper-locations=classpath:mapper/*.xml

# å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ è¿™è¡Œé…ç½®
```

### Q3: APIè¿”å›404
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
curl http://localhost:8080/project/list

# æ£€æŸ¥æ—¥å¿—
tail -f logs/application.log
```

### Q4: æ·»åŠ å…³è”å¤±è´¥
```sql
-- æ£€æŸ¥é¡¹ç›®æ˜¯å¦å­˜åœ¨
SELECT * FROM project WHERE id = 1;

-- æ£€æŸ¥ç¬”è®°æ˜¯å¦å­˜åœ¨ï¼ˆæ ¹æ®å®é™…è¡¨åï¼‰
-- SELECT * FROM fragment_note WHERE id = 5;

-- æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å…³è”
SELECT * FROM project_note_relation 
WHERE project_id = 1 AND note_id = 5;
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### æµ‹è¯•è„šæœ¬
```sql
-- æ’å…¥1000æ¡æµ‹è¯•æ•°æ®
DELIMITER //
CREATE PROCEDURE insert_test_data()
BEGIN
    DECLARE i INT DEFAULT 1;
    WHILE i <= 1000 DO
        INSERT INTO project_note_relation 
        (project_id, note_id, note_type, rec_creator, arch_flag)
        VALUES 
        (FLOOR(1 + RAND() * 10), i, 'framework', 'admin', '1');
        SET i = i + 1;
    END WHILE;
END//
DELIMITER ;

-- æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹
CALL insert_test_data();

-- æ€§èƒ½æµ‹è¯•æŸ¥è¯¢
SELECT BENCHMARK(1000, (
    SELECT COUNT(*) FROM project_note_relation WHERE project_id = 1
));
```

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡
- å•æ¬¡æŸ¥è¯¢ < 10ms
- å•æ¬¡æ’å…¥ < 50ms
- 1000æ¡æ•°æ®æŸ¥è¯¢ < 100ms

## ğŸ¯ å‰ç«¯é›†æˆ

å‰ç«¯ä»£ç å·²ç»å‡†å¤‡å¥½ï¼Œä½äºï¼š
- `fronted/src/views/daily/ProjectRecord.vue` (å·²ä¿®æ”¹)

å‰ç«¯APIè°ƒç”¨ç¤ºä¾‹ï¼š
```typescript
// è·å–é¡¹ç›®ç¬”è®°
const response = await request.get(`/project/${projectId}/notes`)

// æ·»åŠ ç¬”è®°
const response = await request.post(`/project/${projectId}/notes`, {
  noteId: noteId
})

// åˆ é™¤ç¬”è®°
const response = await request.delete(`/project/${projectId}/notes/${noteId}`)
```

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²å®Œæˆåï¼š
1. å‰ç«¯"ç¬”è®°è°ƒç”¨"åŠŸèƒ½å°†æ­£å¸¸å·¥ä½œ
2. å¯ä»¥ä¸ºé¡¹ç›®å…³è”ç¬”è®°
3. æ”¯æŒæœç´¢ã€ç­›é€‰å’ŒæŸ¥çœ‹ç¬”è®°
4. æ‰€æœ‰æ“ä½œä¼šæŒä¹…åŒ–åˆ°æ•°æ®åº“

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¡¨æ˜¯å¦æ­£ç¡®åˆ›å»º
2. åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
3. APIæ¥å£æ˜¯å¦å¯è®¿é—®
4. å‰ç«¯æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š`backed/é¡¹ç›®ç¬”è®°å…³è”åŠŸèƒ½éƒ¨ç½²è¯´æ˜.md`
















