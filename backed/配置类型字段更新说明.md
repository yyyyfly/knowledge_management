# 笔记配置类型字段更新说明

## 问题描述

原先数据库中的`km_note_config`表的`config_type`字段与前端`MaterialRecord.vue`中新建笔记表单使用的字段名称不一致，导致配置管理界面无法正常工作。

## 修复内容

### 1. 框架笔记（framework）
- **旧配置类型**：
  - `category`（分类）
  - `subject`（学科）
- **新配置类型**：
  - `subjectType`（学科类型）
  - `knowledgePoint`（知识点类型）

### 2. 求学笔记（study）
- **旧配置类型**：
  - `subject`（学科）
  - `course`（课程）
- **新配置类型**：
  - `subject`（学科）
  - `knowledgePoint`（知识点）

### 3. 背诵笔记（memorization）
- **旧配置类型**：
  - `subject`（科目）
  - `category`（分类）
- **新配置类型**：
  - `subject`（科目）
  - `knowledgePoint`（知识点）

### 4. 刷题笔记（exercise）
- **配置类型**：（无需修改）
  - `source`（题目来源）
  - `subject`（学科类型）

### 5. 实战笔记（practical）
- **配置类型**：（无需修改）
  - `domain`（领域）
  - `techStack`（技术栈）

### 6. 碎片笔记（fragment）
- **配置类型**：（无需修改）
  - `category`（分类）
  - `theme`（主题）

## 数据库更新步骤

### 方案一：清空重建（推荐用于开发环境）

如果是开发环境且数据可以丢弃，直接删除旧数据并重新导入：

```sql
-- 1. 清空配置表
TRUNCATE TABLE `km_note_config`;

-- 2. 重新导入配置数据
SOURCE backed/src/main/resources/db/km_note_config.sql;
```

### 方案二：更新现有数据（推荐用于生产环境）

如果需要保留现有配置数据，执行以下更新语句：

```sql
-- 更新框架笔记配置类型
UPDATE `km_note_config` 
SET `config_type` = 'subjectType' 
WHERE `note_type` = 'framework' AND `config_type` = 'category';

UPDATE `km_note_config` 
SET `config_type` = 'knowledgePoint' 
WHERE `note_type` = 'framework' AND `config_type` = 'subject';

-- 更新求学笔记配置类型
UPDATE `km_note_config` 
SET `config_type` = 'knowledgePoint' 
WHERE `note_type` = 'study' AND `config_type` = 'course';

-- 更新背诵笔记配置类型
UPDATE `km_note_config` 
SET `config_type` = 'knowledgePoint' 
WHERE `note_type` = 'memorization' AND `config_type` = 'category';
```

## 前端修改

`fronted/src/views/daily/MaterialRecord.vue`中的`configTypeMap`已更新为：

```typescript
const configTypeMap = {
  fragment: { type1: { key: 'category', label: '分类' }, type2: { key: 'theme', label: '主题' } },
  study: { type1: { key: 'subject', label: '学科' }, type2: { key: 'knowledgePoint', label: '知识点' } },
  memorization: { type1: { key: 'subject', label: '科目' }, type2: { key: 'knowledgePoint', label: '知识点' } },
  exercise: { type1: { key: 'source', label: '题目来源' }, type2: { key: 'subject', label: '学科类型' } },
  practical: { type1: { key: 'domain', label: '领域' }, type2: { key: 'techStack', label: '技术栈' } },
  framework: { type1: { key: 'subjectType', label: '学科类型' }, type2: { key: 'knowledgePoint', label: '知识点类型' } }
}
```

## 验证步骤

1. 启动后端服务
2. 访问 `http://localhost:5173/daily/material-record`
3. 展开"笔记分类标签管理"
4. 依次选择每种笔记类型，确认配置项正确显示
5. 测试添加和删除配置项功能

## 注意事项

1. 更新数据库前请备份数据
2. 确保前后端代码都已更新
3. 更新后需要重启后端服务
4. 清除浏览器缓存后重新访问前端页面


