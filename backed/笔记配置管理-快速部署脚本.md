# 笔记配置管理 - 快速部署脚本

## 执行顺序

1. ✅ 数据库SQL（已完成）- 执行 `km_note_config.sql`
2. ✅ 后端API（已完成）- NoteConfig相关代码
3. ✅ 前端API（已完成）- noteConfig.ts
4. ✅ 学习笔记（已完成）- StudyNotes.vue
5. ⏳ 以下4个笔记类型需要应用修改

## 背诵笔记 (MemorizationNotes.vue)

### 修改1：导入API（在script setup部分）
在现有导入后添加：
```ts
import { getConfigsByNoteType, createConfig, updateConfig as updateConfigAPI, deleteConfig as deleteConfigAPI, type NoteConfig } from '@/api/noteConfig'
```

### 修改2：在阅读笔记卡片后添加配置UI
找到类似这样的代码结构（通常在统计卡片之后）并在其后插入：
```vue
    <!-- 背诵笔记配置 -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-cog text-white"></i>
          </div>
          <h2 class="text-xl font-semibold text-gray-900">背诵笔记配置</h2>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- 科目配置 -->
        <div class="border border-gray-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-gray-800">科目</h3>
            <button 
              @click="openAddConfigModal('subject')"
              class="px-3 py-1.5 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors flex items-center space-x-1"
            >
              <i class="fas fa-plus"></i>
              <span>添加</span>
            </button>
          </div>
          <div class="space-y-2 max-h-60 overflow-y-auto">
            <div 
              v-for="item in configSubjects" 
              :key="item.id"
              class="flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
            >
              <input 
                type="text" 
                v-model="item.configName"
                @blur="updateConfig(item)"
                class="flex-1 bg-transparent border-none focus:outline-none text-sm"
              />
              <button 
                @click="deleteConfig(item.id!)"
                class="ml-2 text-red-500 hover:text-red-700 text-sm"
              >
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- 分类配置 -->
        <div class="border border-gray-200 rounded-lg p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-gray-800">分类</h3>
            <button 
              @click="openAddConfigModal('category')"
              class="px-3 py-1.5 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors flex items-center space-x-1"
            >
              <i class="fas fa-plus"></i>
              <span>添加</span>
            </button>
          </div>
          <div class="space-y-2 max-h-60 overflow-y-auto">
            <div 
              v-for="item in configCategories" 
              :key="item.id"
              class="flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
            >
              <input 
                type="text" 
                v-model="item.configName"
                @blur="updateConfig(item)"
                class="flex-1 bg-transparent border-none focus:outline-none text-sm"
              />
              <button 
                @click="deleteConfig(item.id!)"
                class="ml-2 text-red-500 hover:text-red-700 text-sm"
              >
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
```

### 修改3：添加响应式变量和函数（在loadNotes函数之后）
```ts
// 配置数据
const configSubjects = ref<NoteConfig[]>([])
const configCategories = ref<NoteConfig[]>([])
const showAddConfigModal = ref(false)
const currentConfigType = ref<'subject' | 'category'>('subject')
const newConfigName = ref('')

// 加载配置
const loadConfigs = async () => {
  try {
    const res = await getConfigsByNoteType('memorization')
    if (res.code === 200 && res.data) {
      configSubjects.value = res.data.filter((c: NoteConfig) => c.configType === 'subject')
      configCategories.value = res.data.filter((c: NoteConfig) => c.configType === 'category')
    }
  } catch (error) {
    console.error('加载配置失败:', error)
  }
}

// 打开添加配置弹窗
const openAddConfigModal = (type: 'subject' | 'category') => {
  currentConfigType.value = type
  newConfigName.value = ''
  showAddConfigModal.value = true
}

// 添加配置
const addConfig = async () => {
  if (!newConfigName.value.trim()) {
    alert('请输入配置名称')
    return
  }

  try {
    const res = await createConfig({
      noteType: 'memorization',
      configType: currentConfigType.value,
      configName: newConfigName.value.trim()
    })
    
    if (res.code === 200) {
      await loadConfigs()
      showAddConfigModal.value = false
      newConfigName.value = ''
      alert('添加成功')
    } else {
      alert(res.message || '添加失败')
    }
  } catch (error: any) {
    console.error('添加配置失败:', error)
    alert(error.message || '添加失败')
  }
}

// 更新配置
const updateConfig = async (config: NoteConfig) => {
  if (!config.configName.trim()) {
    alert('配置名称不能为空')
    await loadConfigs()
    return
  }

  try {
    const res = await updateConfigAPI(config)
    if (res.code === 200) {
      console.log('更新成功')
    } else {
      alert(res.message || '更新失败')
      await loadConfigs()
    }
  } catch (error: any) {
    console.error('更新配置失败:', error)
    alert(error.message || '更新失败')
    await loadConfigs()
  }
}

// 删除配置
const deleteConfig = async (id: number) => {
  if (!confirm('确定要删除这个配置吗？')) {
    return
  }

  try {
    const res = await deleteConfigAPI(id)
    if (res.code === 200) {
      await loadConfigs()
      alert('删除成功')
    } else {
      alert(res.message || '删除失败')
    }
  } catch (error: any) {
    console.error('删除配置失败:', error)
    alert(error.message || '删除失败')
  }
}
```

### 修改4：更新onMounted和onActivated
```ts
onMounted(() => {
  loadNotes()
  loadConfigs()  // 新增这一行
})

onActivated(() => {
  loadNotes()
  loadConfigs()  // 新增这一行
})
```

### 修改5：在template末尾（`</template>`之前）添加弹窗
```vue
    <!-- 添加配置弹窗 -->
    <Transition name="modal-fade">
      <div v-if="showAddConfigModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <Transition name="modal-slide">
          <div v-if="showAddConfigModal" class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-gray-900">
                添加{{ currentConfigType === 'subject' ? '科目' : '分类' }}
              </h3>
              <button 
                @click="showAddConfigModal = false"
                class="text-gray-400 hover:text-gray-600 transition-colors"
              >
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>

            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                {{ currentConfigType === 'subject' ? '科目' : '分类' }}名称
              </label>
              <input 
                v-model="newConfigName"
                type="text" 
                :placeholder="`输入自定义${currentConfigType === 'subject' ? '科目' : '分类'}名称`"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                @keyup.enter="addConfig"
              />
            </div>

            <div class="flex items-center justify-end space-x-3">
              <button 
                @click="showAddConfigModal = false"
                class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"
              >
                取消
              </button>
              <button 
                @click="addConfig"
                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
              >
                添加
              </button>
            </div>
          </div>
        </Transition>
      </div>
    </Transition>
  </div>
</template>
```

---

## 刷题笔记 (ExerciseNotes.vue)

使用与背诵笔记相同的步骤，但参数修改为：
- noteType: `'exercise'`
- 配置类型1: `'subject'` / '学科'
- 配置类型2: `'source'` / '题目来源'
- 变量名: `configSubjects`, `configSources`
- 类型定义: `'subject' | 'source'`

---

## 实战笔记 (PracticalNotes.vue)

使用与背诵笔记相同的步骤，但参数修改为：
- noteType: `'practical'`
- 配置类型1: `'domain'` / '领域'
- 配置类型2: `'techStack'` / '技术栈'
- 变量名: `configDomains`, `configTechStacks`
- 类型定义: `'domain' | 'techStack'`

---

## 框架笔记 (FrameworkNotes.vue)

使用与背诵笔记相同的步骤，但参数修改为：
- noteType: `'framework'`
- 配置类型1: `'category'` / '分类'
- 配置类型2: `'subject'` / '学科'
- 变量名: `configCategories`, `configSubjects`
- 类型定义: `'category' | 'subject'`

---

## 快速参数对照表

| 笔记类型 | Vue文件 | noteType | type1 | type2 | var1 | var2 |
|---------|---------|----------|-------|-------|------|------|
| 背诵笔记 | MemorizationNotes.vue | memorization | subject/科目 | category/分类 | configSubjects | configCategories |
| 刷题笔记 | ExerciseNotes.vue | exercise | subject/学科 | source/题目来源 | configSubjects | configSources |
| 实战笔记 | PracticalNotes.vue | practical | domain/领域 | techStack/技术栈 | configDomains | configTechStacks |
| 框架笔记 | FrameworkNotes.vue | framework | category/分类 | subject/学科 | configCategories | configSubjects |

---

## 全局查找替换技巧

使用VS Code等编辑器，对每个文件：

1. 复制StudyNotes.vue的配置管理代码块
2. 全局替换关键词（在复制的代码中）：
   - `'study'` → 对应的noteType
   - `'subject', 'course'` → 对应的配置类型
   - `学科`, `课程` → 对应的中文名
   - `configSubjects`, `configCourses` → 对应的变量名

---

## 测试验证

完成每个文件后，测试验证：
1. 启动前端开发服务器
2. 访问对应笔记页面
3. 看到"XX笔记配置"区域
4. 点击"添加"按钮，输入新配置
5. 刷新页面，配置保留
6. 编辑配置名称，删除配置功能正常

---

## 完整部署命令

```bash
# 1. 执行SQL（首次部署）
cd backed
mysql -u root -p knowledge_management < src/main/resources/db/km_note_config.sql

# 2. 重启后端
mvn spring-boot:run

# 3. 重启前端（另一个终端）
cd ../fronted
npm run dev
```

---

## 完成后检查清单

- [ ] 学习笔记配置管理 ✅
- [ ] 背诵笔记配置管理  
- [ ] 刷题笔记配置管理  
- [ ] 实战笔记配置管理  
- [ ] 框架笔记配置管理  
- [ ] 碎片笔记配置管理 ✅

全部完成后，6种笔记类型都支持动态配置管理！


