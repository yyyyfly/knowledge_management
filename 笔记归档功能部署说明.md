# 笔记归档整理功能部署说明

## 功能概述

笔记归档整理功能用于管理笔记的来源材料。与六大笔记分类不同，这个功能专注于整理笔记的来源，例如：
- 一本书可能包含多种类型的笔记（刷题笔记、求学笔记等）
- 一门课程可能产生多份不同类型的笔记
- 一份材料可能被提炼成多个笔记

通过归档功能，您可以追踪所有笔记的来源，方便后续整理和回溯。

## 功能特点

1. **归档管理**
   - 创建归档（书籍、课程、材料、视频等）
   - 编辑归档信息
   - 删除归档（同时删除所有关联关系）
   - 搜索和筛选归档

2. **笔记关联**
   - 将已有笔记添加到归档
   - 为每个关联添加备注（如章节、页码等）
   - 从归档中移除笔记
   - 查看归档包含的所有笔记

3. **详细信息**
   - 归档名称和类型
   - 来源信息（作者、出版社、链接等）
   - 归档描述
   - 标签管理
   - 笔记数量统计

## 部署步骤

### 1. 数据库初始化

执行SQL脚本创建所需的表：

```bash
# 在MySQL中执行
mysql -u your_username -p your_database < backed/create_note_archive_table.sql
```

SQL脚本会创建两张表：
- `note_archive`: 笔记归档表
- `note_archive_relation`: 笔记归档关联表（多对多关系）

### 2. 后端部署

后端已创建以下文件：

**实体类：**
- `backed/src/main/java/com/knowledge/entity/NoteArchive.java`
- `backed/src/main/java/com/knowledge/entity/NoteArchiveRelation.java`

**DTO类：**
- `backed/src/main/java/com/knowledge/dto/NoteArchiveDTO.java`
- `backed/src/main/java/com/knowledge/dto/NoteArchiveNoteDTO.java`

**Mapper接口：**
- `backed/src/main/java/com/knowledge/mapper/NoteArchiveMapper.java`
- `backed/src/main/java/com/knowledge/mapper/NoteArchiveRelationMapper.java`

**XML映射：**
- `backed/src/main/resources/mapper/NoteArchiveMapper.xml`
- `backed/src/main/resources/mapper/NoteArchiveRelationMapper.xml`

**服务和控制器：**
- `backed/src/main/java/com/knowledge/service/NoteArchiveService.java`
- `backed/src/main/java/com/knowledge/controller/NoteArchiveController.java`

编译并重启后端服务：

```bash
cd backed
mvn clean package
# 重启服务
```

### 3. 前端部署

前端已修改/创建以下文件：

**API接口：**
- `fronted/src/api/noteArchive.ts` (新建)

**页面组件：**
- `fronted/src/views/daily/MaterialRecord.vue` (已修改)

重新编译前端：

```bash
cd fronted
npm install  # 如果需要
npm run build
```

### 4. 验证部署

1. 启动后端服务
2. 访问前端页面
3. 进入"笔记记录"页面
4. 找到"笔记归档整理"区域
5. 点击"新建归档"测试功能

## API接口说明

### 归档管理接口

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/note-archive/create` | POST | 创建归档 |
| `/api/note-archive/update` | POST | 更新归档 |
| `/api/note-archive/delete/{id}` | DELETE | 删除归档 |
| `/api/note-archive/detail/{id}` | GET | 查询归档详情 |
| `/api/note-archive/list` | GET | 查询归档列表 |
| `/api/note-archive/add-note` | POST | 添加笔记到归档 |
| `/api/note-archive/remove-note` | DELETE | 从归档中移除笔记 |
| `/api/note-archive/update-relation-note` | POST | 更新关联备注 |
| `/api/note-archive/by-note/{noteId}` | GET | 查询笔记关联的所有归档 |

## 使用说明

### 1. 创建归档

1. 点击"新建归档"按钮
2. 填写归档信息：
   - 归档名称（必填）：如《深入理解计算机系统》
   - 归档类型：书籍、课程、材料、视频、其他
   - 来源信息：作者、出版社、链接等
   - 描述：简要说明
   - 标签：方便分类和搜索
3. 点击"创建"保存

### 2. 查看归档

1. 点击"查看归档"按钮展开归档列表
2. 可以通过搜索框和类型筛选来查找归档
3. 点击归档卡片查看详情

### 3. 管理关联笔记

在归档详情页面：
1. 点击"添加笔记"从现有笔记中选择
2. 可以为每个关联添加备注（如：第3章、P45-67）
3. 点击编辑按钮修改备注
4. 点击移除按钮解除关联

### 4. 编辑和删除

- 在归档卡片上悬停，显示编辑和删除按钮
- 点击编辑按钮修改归档信息
- 点击删除按钮删除归档（会同时删除所有关联关系）

## 数据库表结构

### note_archive 表

| 字段 | 类型 | 说明 |
|------|------|------|
| ID | BIGINT | 主键 |
| ARCHIVE_NAME | VARCHAR(200) | 归档名称 |
| ARCHIVE_TYPE | VARCHAR(50) | 归档类型 |
| DESCRIPTION | TEXT | 描述 |
| SOURCE_INFO | VARCHAR(500) | 来源信息 |
| TAGS | TEXT | 标签（JSON） |
| NOTE_COUNT | INT | 笔记数量 |
| REC_CREATOR | VARCHAR(64) | 创建人 |
| REC_CREATE_TIME | DATETIME | 创建时间 |
| REC_REVISOR | VARCHAR(64) | 修改人 |
| REC_REVISE_TIME | DATETIME | 修改时间 |
| ARCH_FLAG | TINYINT | 归档标志 |

### note_archive_relation 表

| 字段 | 类型 | 说明 |
|------|------|------|
| ID | BIGINT | 主键 |
| ARCHIVE_ID | BIGINT | 归档ID |
| NOTE_ID | BIGINT | 笔记ID |
| RELATION_NOTE | VARCHAR(500) | 关联备注 |
| REC_CREATOR | VARCHAR(64) | 创建人 |
| REC_CREATE_TIME | DATETIME | 创建时间 |
| REC_REVISOR | VARCHAR(64) | 修改人 |
| REC_REVISE_TIME | DATETIME | 修改时间 |
| ARCH_FLAG | TINYINT | 归档标志 |

## 注意事项

1. 删除归档时会同时删除所有关联关系，但不会删除笔记本身
2. 一条笔记可以关联到多个归档
3. 关联备注字段可选，用于记录笔记在归档中的具体位置
4. 归档数量会自动统计，不需要手动维护

## 后续优化建议

1. 添加批量添加笔记功能
2. 支持导出归档及其关联笔记
3. 添加归档统计图表
4. 支持归档封面图片
5. 添加归档分享功能

## 常见问题

### Q: 归档和笔记分类有什么区别？
A: 笔记分类（六大笔记）是按内容和用途分类，而归档是按来源分类。一本书可能产生多种类型的笔记。

### Q: 可以把一条笔记加到多个归档吗？
A: 可以。一条笔记可能来自多个来源的综合整理。

### Q: 删除归档会删除笔记吗？
A: 不会。删除归档只会删除关联关系，笔记本身不受影响。

### Q: 关联备注有什么用？
A: 用于记录笔记在归档中的具体位置，如"第3章"、"P45-67"等，方便回溯。

---

部署完成后，您就可以开始整理您的100份笔记了！祝使用愉快！

